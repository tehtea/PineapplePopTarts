<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: SocialMediaUpdater/facebookPoster.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: SocialMediaUpdater/facebookPoster.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * There are multiple kinds of tokens in the Facebook API. 
 * 
 * To post on pages, you need to get an app token first,
 * followed by a user access token with the manage_pages and publish_pages permissions,
 * then a token for page access.
 * 
 * In the end, I got a short-term page access token, then extended its life to 2 months using this tutorial: https://dev.to/daviducolo/permanent-facebook-page-access-token-3epi
 * See: https://developers.facebook.com/docs/pages/getting-started
 * 
 * For now, the page access token is hardcoded into this file, but in a proper project it should be read from a text file for extensibility.
 * 
 * Anyway, this code should do very basic stuff: it should just get the latest incident report from the call operator interface
 * and parse it into a facebook post to be posted.
 * 
 * Tl;dr: this script alone is good enough for posting on Facebook for at least 2 months until May 2019. 
 */

 // modules and libraries
const 	request = require('request'),
		path 	= require('path');

/**
 * Post something on the page. If the post is successful, resolve the new Promise created, and if it is unsuccessful, reject it.
 * @param pageId pageId of the page to post to
 * @param postMessage the message to be posted
 * @param pageAccessToken the page access token required to authenticate the request with Facebook API.
 * 
 * @returns a Promise.
 * */ 
function postOnPage(pageId, postMessage, pageAccessToken) {
	return new Promise((resolve, reject) => {
		var options = {
			url: `https://graph.facebook.com/${pageId}/feed?message=${postMessage}`,
			headers: {
				'Authorization': 'Bearer' + ' ' + `${pageAccessToken}`
			}
		};
		request.post(options).on('response', function(response) {
			if (response.statusCode == 200)
				resolve(response.statusCode);
			else 
				reject(response.statusCode);
		});
	});
}

module.exports = {postOnPage};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#checkAccount">checkAccount</a></li><li><a href="global.html#checkPostalCode">checkPostalCode</a></li><li><a href="global.html#config">config</a></li><li><a href="global.html#dbConfig">dbConfig</a></li><li><a href="global.html#dbQuery">dbQuery</a></li><li><a href="global.html#express">express</a></li><li><a href="global.html#fetchData">fetchData</a></li><li><a href="global.html#getAllNewIncident">getAllNewIncident</a></li><li><a href="global.html#getAllRespondentRequested">getAllRespondentRequested</a></li><li><a href="global.html#getAllUpdateIncident">getAllUpdateIncident</a></li><li><a href="global.html#getFormViaRecordID">getFormViaRecordID</a></li><li><a href="global.html#getRecentNewIncident">getRecentNewIncident</a></li><li><a href="global.html#getRecentRespondentRequested">getRecentRespondentRequested</a></li><li><a href="global.html#getRecentUpdateIncident">getRecentUpdateIncident</a></li><li><a href="global.html#getRecordIDIncident">getRecordIDIncident</a></li><li><a href="global.html#getRespondents">getRespondents</a></li><li><a href="global.html#getTimeUpdateIncident">getTimeUpdateIncident</a></li><li><a href="global.html#getUnresolvedIncidents">getUnresolvedIncidents</a></li><li><a href="global.html#path">path</a></li><li><a href="global.html#postOnPage">postOnPage</a></li><li><a href="global.html#postTweet">postTweet</a></li><li><a href="global.html#resolveIncident">resolveIncident</a></li><li><a href="global.html#routes">routes</a></li><li><a href="global.html#storeNewIncident">storeNewIncident</a></li><li><a href="global.html#storeRespondent">storeRespondent</a></li><li><a href="global.html#storeUpdateIncident">storeUpdateIncident</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Apr 07 2019 01:01:08 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
